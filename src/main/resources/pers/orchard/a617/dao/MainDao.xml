<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pers.orchard.a617.dao.MainDao">
    <resultMap id="DeviceResultMap" type="pers.orchard.a617.bean.Device">
        <id column="id" jdbcType="INTEGER" property="ID"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="date_registered" jdbcType="DATE" property="dateRegistered"/>
        <result column="date_visited" jdbcType="DATE" property="dateVisited"/>
    </resultMap>

    <resultMap id="FolderResultMap" type="pers.orchard.a617.bean.photo.PhotoFolder">
        <id column="id" jdbcType="INTEGER" property="ID"/>
        <result column="id_parent" jdbcType="INTEGER" property="IDParent"/>
        <result column="id_created_device" jdbcType="INTEGER" property="IDCreatedDevice"/>
        <result column="id_cover" jdbcType="INTEGER" property="IDCover"/>
        <result column="name_storage" jdbcType="VARCHAR" property="nameStorage"/>
        <result column="name_display" jdbcType="VARCHAR" property="nameDisplay"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="date_created" jdbcType="TIMESTAMP" property="dateCreated"/>
        <result column="date_updated" jdbcType="TIMESTAMP" property="dateUpdated"/>
        <result column="count_updated" jdbcType="INTEGER" property="countUpdated"/>
    </resultMap>

    <resultMap id="PhotoResultMap" type="pers.orchard.a617.bean.photo.PhotoPhoto">
        <id column="id" jdbcType="INTEGER" property="ID"/>
        <result column="id_folder" jdbcType="INTEGER" property="IDFolder"/>
        <result column="ids_tag" jdbcType="VARCHAR" property="IDsTagTransfer"/>
        <result column="id_register_device" jdbcType="INTEGER" property="IDRegisterDevice"/>
        <result column="ids_storage_device" jdbcType="VARCHAR" property="IDsStorageDeviceTransfer"/>
        <result column="name_display" jdbcType="VARCHAR" property="nameDisplay"/>
        <result column="name_storage" jdbcType="VARCHAR" property="nameStorage"/>
        <result column="name_register" jdbcType="VARCHAR" property="nameRegister"/>
        <result column="name_folder" jdbcType="VARCHAR" property="nameFolder"/>
        <result column="names_tag" jdbcType="VARCHAR" property="namesTagTransfer"/>
        <result column="names_storage_device" jdbcType="VARCHAR" property="namesStorageDeviceTransfer"/>
        <result column="file_size" jdbcType="INTEGER" property="fileSize"/>
        <result column="width" jdbcType="INTEGER" property="width"/>
        <result column="height" jdbcType="INTEGER" property="height"/>
        <result column="mime_type" jdbcType="VARCHAR" property="mimeType"/>
        <result column="latitude" jdbcType="VARCHAR" property="latitude"/>
        <result column="longitude" jdbcType="VARCHAR" property="longitude"/>
        <result column="orientation" jdbcType="INTEGER" property="orientation"/>
        <result column="date_taken" jdbcType="TIMESTAMP" property="dateTaken"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="md5" jdbcType="VARCHAR" property="MD5"/>
        <result column="presence_local_full" jdbcType="BOOLEAN" property="presenceLocalFull"/>
        <result column="presence_local_thumb" jdbcType="BOOLEAN" property="presenceLocalThumb"/>
        <result column="presence_cloud_thumb" jdbcType="BOOLEAN" property="presenceCloudThumb"/>
        <result column="path_local_full" jdbcType="VARCHAR" property="pathLocalFull"/>
        <result column="path_local_thumb" jdbcType="VARCHAR" property="pathLocalThumb"/>
        <result column="date_registered" jdbcType="TIMESTAMP" property="dateRegistered"/>
        <result column="date_updated" jdbcType="TIMESTAMP" property="dateUpdated"/>
        <result column="count_updated" jdbcType="INTEGER" property="countUpdated"/>
    </resultMap>

    <resultMap id="LabelResultMap" type="pers.orchard.a617.bean.photo.PhotoTagPhoto">
        <id column="id" jdbcType="INTEGER" property="ID"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="date_created" jdbcType="TIMESTAMP" property="dateCreated"/>
        <result column="date_updated" jdbcType="TIMESTAMP" property="dateUpdated"/>
        <result column="count_updated" jdbcType="INTEGER" property="countUpdated"/>
    </resultMap>

    <resultMap id="VersionResultMap" type="pers.orchard.a617.bean.Version">
        <result column="device_version" jdbcType="INTEGER" property="deviceVersion"/>
        <result column="device_date" jdbcType="TIMESTAMP" property="deviceDateUpdated"/>
        <result column="folder_version" jdbcType="INTEGER" property="folderVersion"/>
        <result column="folder_date" jdbcType="TIMESTAMP" property="folderDateUpdated"/>
        <result column="photo_version" jdbcType="INTEGER" property="photoVersion"/>
        <result column="photo_date" jdbcType="TIMESTAMP" property="photoDateUpdated"/>
        <result column="label_version" jdbcType="INTEGER" property="labelVersion"/>
        <result column="label_date" jdbcType="TIMESTAMP" property="labelDateUpdated"/>
    </resultMap>

    <insert id="initialVersion">
        insert into version (name, version)
        VALUES ('device', 1),
               ('folder', 1),
               ('photo', 1),
               ('label', 1)
        on duplicate key update date_updated = current_timestamp,
                                version      = version + 1;
    </insert>

    <insert id="initialDevice">
        insert into device (id, name)
        VALUES (0, 'system');
    </insert>

    <insert id="initialFolder">
        insert into photo_folder (id, id_parent, id_created_device, id_cover, name_storage, name_display, description)
        VALUES (0, 0, 0, 0, 'root', 'root', '');
    </insert>

    <insert id="insertSomeDevice" parameterType="list">
        insert into device (id, name, date_registered, date_visited)
        values
        <foreach collection="list" item="device" separator=", ">
            (#{device.ID}, #{device.name}, #{device.dateRegistered}, #{device.dateVisited})
        </foreach>
    </insert>

    <insert id="insertSomeFolder" parameterType="list">
        insert into photo_folder (id, id_parent, id_created_device, id_cover, name_storage, name_display, description,
        date_created, date_updated, count_updated)
        VALUES
        <foreach collection="list" item="folder" separator=", ">
            (#{folder.ID}, #{folder.IDParent}, #{folder.IDCreatedDevice}, #{folder.IDCover}, #{folder.nameStorage},
            #{folder.nameDisplay}, #{folder.description}, #{folder.dateCreated}, #{folder.dateUpdated},
            #{folder.countUpdated})
        </foreach>
    </insert>

    <insert id="insertSomePhoto" parameterType="list">
        insert into photo_photo (id, id_folder, ids_tag, id_register_device, ids_storage_device, name_display,
        name_storage,
        name_register, name_folder, names_tag, names_storage_device, file_size, width, height,
        mime_type, latitude, longitude, orientation, date_taken, description, md5, presence_local_full,
        presence_local_thumb, presence_cloud_thumb, path_local_full, path_local_thumb, date_registered,
        date_updated, count_updated)
        VALUES
        <foreach collection="list" item="photo" separator=", ">
            (#{photo.ID},#{photo.IDFolder},#{photo.IDsTagTransfer},#{photo.IDRegisterDevice},#{photo.IDsStorageDeviceTransfer},#{photo.nameDisplay},#{photo.nameStorage},#{photo.nameRegister},#{photo.nameFolder},#{photo.namesTagTransfer},#{photo.namesStorageDeviceTransfer},#{photo.fileSize},#{photo.width},#{photo.height},#{photo.mimeType},#{photo.latitude},#{photo.longitude},#{photo.orientation},#{photo.dateTaken},#{photo.description},#{photo.MD5},#{photo.presenceLocalFull},#{photo.presenceLocalThumb},#{photo.presenceCloudThumb},#{photo.pathLocalFull},#{photo.pathLocalThumb},#{photo.dateRegistered},#{photo.dateRegistered},#{photo.countUpdated})
        </foreach>
    </insert>

    <insert id="insertSomeLabel" parameterType="list">
        insert into photo_label (id, name, date_created, date_updated, count_updated)
        values
        <foreach collection="list" item="label" separator=", ">
            (#{label.ID},#{label.name},#{label.dateCreated},#{label.dateUpdated},#{label.countUpdated})
        </foreach>
    </insert>

    <update id="updateDevice" parameterType="pers.orchard.a617.bean.Device">
        UPDATE device t
        SET t.name            = #{name},
            t.date_registered = #{dateRegistered},
            t.date_visited    = #{dateVisited}
        WHERE t.id = #{ID};
    </update>

    <update id="updateFolder" parameterType="pers.orchard.a617.bean.photo.PhotoFolder">
        UPDATE photo_folder t
        SET t.id_parent         = #{IDParent},
            t.id_created_device = #{IDCreatedDevice},
            t.id_cover          = #{IDCover},
            t.name_storage      = #{nameStorage},
            t.name_display      = #{nameDisplay},
            t.description       = #{description},
            t.date_created      = #{dateCreated},
            t.date_updated      = #{dateUpdated},
            t.count_updated     = #{countUpdated}
        WHERE t.id = #{ID}
    </update>

    <update id="updatePhoto" parameterType="pers.orchard.a617.bean.photo.PhotoPhoto">
        UPDATE photo_photo t
        SET t.id_folder            = #{IDFolder},
            t.ids_tag              = #{IDsTagTransfer},
            t.id_register_device   = #{IDRegisterDevice},
            t.ids_storage_device   = #{IDsStorageDeviceTransfer},
            t.name_display         = #{nameDisplay},
            t.name_storage         = #{nameStorage},
            t.name_register        = #{nameRegister},
            t.name_folder          = #{nameFolder},
            t.names_tag            = #{namesTagTransfer},
            t.names_storage_device = #{namesStorageDeviceTransfer},
            t.file_size            = #{fileSize},
            t.width                = #{width},
            t.height               = #{height},
            t.mime_type            = #{mimeType},
            t.latitude             = #{latitude},
            t.longitude            = #{longitude},
            t.orientation          = #{orientation},
            t.date_taken           = #{dateTaken},
            t.description          = #{description},
            t.md5                  = #{MD5},
            t.presence_local_full  = #{presenceLocalFull},
            t.presence_local_thumb = #{presenceLocalThumb},
            t.presence_cloud_thumb = #{presenceCloudThumb},
            t.path_local_full      = #{presenceLocalFull},
            t.path_local_thumb     = #{pathLocalThumb},
            t.date_registered      = #{dateRegistered},
            t.date_updated         = #{dateUpdated},
            t.count_updated        = #{countUpdated}
        WHERE t.id = #{ID};
    </update>

    <update id="updateLabel" parameterType="pers.orchard.a617.bean.photo.PhotoTagPhoto">
        UPDATE photo_label t
        SET t.name          = #{name},
            t.date_created  = #{dateCreated},
            t.date_updated  = #{dateUpdated},
            t.count_updated = #{countUpdated}
        WHERE t.id = #{ID};
    </update>

    <delete id="deleteSomeDevice" parameterType="list">
        DELETE FROM device WHERE id in
        <foreach collection="IDs" item="ID" open="(" close=")" separator=", ">
            #{ID}
        </foreach>
    </delete>

    <delete id="deleteSomeFolder">
        DELETE FROM photo_folder WHERE id in
        <foreach collection="IDs" item="ID" open="(" close=")" separator=", ">
            #{ID}
        </foreach>
    </delete>

    <delete id="deleteSomePhoto">
        DELETE FROM photo_photo WHERE id in
        <foreach collection="IDs" item="ID" open="(" close=")" separator=", ">
            #{ID}
        </foreach>
    </delete>

    <delete id="deleteSomeLabel">
        DELETE FROM photo_label WHERE id in
        <foreach collection="IDs" item="ID" open="(" close=")" separator=", ">
            #{ID}
        </foreach>
    </delete>

    <delete id="clearVersion">
        delete
        from version;
    </delete>

    <delete id="clearDevice">
        delete
        from device;
    </delete>

    <delete id="clearFolder">
        delete
        from photo_folder;
    </delete>

    <delete id="clearPhoto">
        delete
        from photo_photo;
    </delete>

    <delete id="clearLabel">
        delete
        from photo_label;
    </delete>

    <select id="selectAllDevice" resultMap="DeviceResultMap">
        select *
        from device;
    </select>

    <select id="selectAllFolder" resultMap="FolderResultMap">
        select *
        from photo_folder;
    </select>

    <select id="selectAllPhoto" resultMap="PhotoResultMap">
        select *
        from photo_photo;
    </select>

    <select id="selectAllLabel" resultMap="LabelResultMap">
        select *
        from photo_label;
    </select>

    <select id="selectAllVersion" resultMap="VersionResultMap">
        select *
        from ((select version device_version, date_updated device_date
               from version
               where name = 'device') tabel1, (select version folder_version, date_updated folder_date
                                               from version
                                               where name = 'folder') table2,
            (select version photo_version, date_updated photo_date
             from version
             where name = 'photo') table3,
            (select version label_version, date_updated label_date
             from version
             where name = 'label') table4);
    </select>
</mapper>